Candidate: CVE-2022-24791
PublicDate: 2022-03-31 23:15:00 UTC
References:
 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-24791
 https://github.com/bytecodealliance/wasmtime/security/advisories/GHSA-gwc9-348x-qwv2
 https://github.com/bytecodealliance/wasmtime/commit/666c2554ea0e1728c35aa41178cf235920db888a
Description:
 Wasmtime is a standalone JIT-style runtime for WebAssembly, using
 Cranelift. There is a use after free vulnerability in Wasmtime when both
 running Wasm that uses externrefs and enabling epoch interruption in
 Wasmtime. If you are not explicitly enabling epoch interruption (it is
 disabled by default) then you are not affected. If you are explicitly
 disabling the Wasm reference types proposal (it is enabled by default) then
 you are also not affected. The use after free is caused by Cranelift
 failing to emit stack maps when there are safepoints inside cold blocks.
 Cold blocks occur when epoch interruption is enabled. Cold blocks are
 emitted at the end of compiled functions, and change the order blocks are
 emitted versus defined. This reordering accidentally caused Cranelift to
 skip emitting some stack maps because it expected to emit the stack maps in
 block definition order, rather than block emission order. When Wasmtime
 would eventually collect garbage, it would fail to find live references on
 the stack because of the missing stack maps, think that they were
 unreferenced garbage, and therefore reclaim them. Then after the collection
 ended, the Wasm code could use the reclaimed-too-early references, which is
 a use after free. Patches have been released in versions 0.34.2 and 0.35.2,
 which fix the vulnerability. All Wasmtime users are recommended to upgrade
 to these patched versions. If upgrading is not an option for you at this
 time, you can avoid the vulnerability by either: disabling the Wasm
 reference types proposal, config.wasm_reference_types(false); or by
 disabling epoch interruption if you were previously enabling it.
 config.epoch_interruption(false).
Ubuntu-Description:
Notes:
 tyhicks> mozjs contains a copy of the SpiderMonkey JavaScript engine
 alexmurray| The wasmtime code appears to be vendored into
  firefox/thunderbird/mozjs etc
Mitigation:
Bugs:
Priority: medium
Discovered-by:
Assigned-to: chrisccoulson
CVSS:
 nvd: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H [9.8 CRITICAL]

Patches_firefox:
upstream_firefox: needs-triage
trusty_firefox: ignored (end of standard support)
trusty/esm_firefox: DNE
xenial_firefox: ignored (end of standard support)
bionic_firefox: ignored (end of standard support, was needed)
focal_firefox: ignored (bundled deps handled by upstream in new versions)
impish_firefox: ignored (end of life)
jammy_firefox: released (1:1snap1-0ubuntu1)
kinetic_firefox: released (1:1snap1-0ubuntu1)
lunar_firefox: released (1:1snap1-0ubuntu1)
mantic_firefox: released (1:1snap1-0ubuntu1)
devel_firefox: released (1:1snap1-0ubuntu1)

Patches_thunderbird:
Priority_thunderbird: low
upstream_thunderbird: needs-triage
trusty_thunderbird: ignored (end of standard support)
trusty/esm_thunderbird: DNE
xenial_thunderbird: ignored (end of standard support)
bionic_thunderbird: ignored (end of standard support, was needed)
focal_thunderbird: ignored (bundled deps handled by upstream in new versions)
impish_thunderbird: ignored (end of life)
jammy_thunderbird: ignored (bundled deps handled by upstream in new versions)
kinetic_thunderbird: ignored (end of life, was needed)
lunar_thunderbird: ignored (bundled deps handled by upstream in new versions)
mantic_thunderbird: ignored (bundled deps handled by upstream in new versions)
devel_thunderbird: ignored (bundled deps handled by upstream in new versions)

Patches_mozjs38:
upstream_mozjs38: needs-triage
trusty_mozjs38: DNE
trusty/esm_mozjs38: DNE
xenial_mozjs38: DNE
bionic_mozjs38: ignored (end of standard support, was needs-triage)
esm-apps/bionic_mozjs38: needs-triage
focal_mozjs38: DNE
impish_mozjs38: DNE
jammy_mozjs38: DNE
kinetic_mozjs38: DNE
lunar_mozjs38: DNE
mantic_mozjs38: DNE
devel_mozjs38: DNE

Patches_mozjs52:
upstream_mozjs52: needs-triage
trusty_mozjs52: DNE
trusty/esm_mozjs52: DNE
xenial_mozjs52: DNE
bionic_mozjs52: ignored (end of standard support, was needs-triage)
esm-infra/bionic_mozjs52: needs-triage
focal_mozjs52: needs-triage
esm-apps/focal_mozjs52: needs-triage
impish_mozjs52: DNE
jammy_mozjs52: DNE
kinetic_mozjs52: DNE
lunar_mozjs52: DNE
mantic_mozjs52: DNE
devel_mozjs52: DNE

Patches_mozjs68:
upstream_mozjs68: needs-triage
trusty_mozjs68: DNE
trusty/esm_mozjs68: DNE
xenial_mozjs68: DNE
bionic_mozjs68: DNE
focal_mozjs68: needs-triage
impish_mozjs68: DNE
jammy_mozjs68: DNE
kinetic_mozjs68: DNE
lunar_mozjs68: DNE
mantic_mozjs68: DNE
devel_mozjs68: DNE

Patches_mozjs78:
upstream_mozjs78: needs-triage
trusty_mozjs78: DNE
trusty/esm_mozjs78: DNE
xenial_mozjs78: DNE
bionic_mozjs78: DNE
focal_mozjs78: DNE
impish_mozjs78: ignored (end of life)
jammy_mozjs78: needs-triage
esm-apps/jammy_mozjs78: needs-triage
kinetic_mozjs78: ignored (end of life, was needs-triage)
lunar_mozjs78: needs-triage
mantic_mozjs78: DNE
devel_mozjs78: DNE

Patches_mozjs91:
upstream_mozjs91: needs-triage
trusty_mozjs91: DNE
trusty/esm_mozjs91: DNE
xenial_mozjs91: DNE
bionic_mozjs91: DNE
focal_mozjs91: DNE
impish_mozjs91: DNE
jammy_mozjs91: needs-triage
kinetic_mozjs91: DNE
lunar_mozjs91: DNE
mantic_mozjs91: DNE
devel_mozjs91: DNE
