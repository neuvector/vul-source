#!/usr/bin/env python3
#
# SPDX-License-Identifier: GPL-3.0-only
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# report and graph package and source counts.
#
# Author: Steve Beattie <steve.beattie@canonical.com>
# Author: Alex Murray <alex.murray@canonical.com>
# Copyright 2008 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.

import sys, os
sys.path.append(os.path.expanduser("~/reviewed/scripts"))
import cve_lib

releases = ['warty','hoary','breezy'] + cve_lib.releases

print('''
set term png small size 800,480
set output "packages.png"

set key off
set xrange [-1:%d]
set offsets 0, 0, 100, 0
set boxwidth 0.2

set grid ytics
set ylabel "Packages in main/restricted (i386)"
''' % (len(releases)))

def dumpplot(suffix=''):
    plots = []
    index = -1
    for rel in releases:
        index += 1
        filename = "%s%s.data" % (rel, suffix)
        x, y = open(filename).readline().strip().split(' ')[1:3]
        print('set label "%d" center at %d,%d' % (int(y), int(x), int(y)+100))

        plots.append('"%s" using 2:3:xtic(1) title "%s" with boxes fs solid lc 1' % (filename, rel))

    print("plot " + ", ".join(plots))

dumpplot()

print('''
set output "sources.png"
set ylabel "Sources in main/restricted"
unset label
''')

dumpplot(suffix='-src')
