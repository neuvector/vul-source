Candidate: CVE-2024-52811
PublicDate: 2024-11-25 19:15:00 UTC
References:
 https://www.cve.org/CVERecord?id=CVE-2024-52811
 https://github.com/ngtcp2/ngtcp2/security/advisories/GHSA-4gmv-gf46-r4g5
 https://github.com/ngtcp2/ngtcp2/commit/44b662bd139c23fee1703bf256c13349e2e624a1
 https://github.com/ngtcp2/ngtcp2/commit/e550c1a414318d0f3f01fca1a621ae0b0428ca15
Description:
 The ngtcp2 project is an effort to implement IETF QUIC protocol in C. In
 affected versions acks are not validated before being written to the qlog
 leading to a buffer overflow. In `ngtcp2_conn::conn_recv_pkt` for an ACK,
 there was new logic that got added to skip `conn_recv_ack` if an ack has
 already been processed in the payload. However, this causes us to also skip
 `ngtcp2_pkt_validate_ack`. The ack which was skipped still got written to
 qlog. The bug occurs in `ngtcp2_qlog::write_ack_frame`. It is now possible
 to reach this code with an invalid ack, suppose `largest_ack=0` and
 `first_ack_range=15`. Subtracting `largest_ack - first_ack_range` will lead
 to an integer underflow which is 20 chars long. However, the ngtcp2 qlog
 code assumes the number written is a signed integer and only accounts for
 19 characters of overhead (see `NGTCP2_QLOG_ACK_FRAME_RANGE_OVERHEAD`).
 Therefore, we overwrite the buffer causing a heap overflow. This is high
 priority and could potentially impact many users if they enable qlog. qlog
 is disabled by default. Due to its overhead, it is most likely used for
 debugging purpose, but the actual use is unknown. ngtcp2 v1.9.1 fixes the
 bug and users are advised to upgrade. Users unable to upgrade should not
 turn on qlog.
Ubuntu-Description:
Notes:
Mitigation:
Bugs:
Priority: medium
Discovered-by:
Assigned-to:
CVSS:

Patches_ngtcp2:
upstream_ngtcp2: not-affected (debian: never in released Debian version)
focal_ngtcp2: DNE
jammy_ngtcp2: needs-triage
esm-apps/jammy_ngtcp2: needs-triage
noble_ngtcp2: needs-triage
esm-apps/noble_ngtcp2: needs-triage
oracular_ngtcp2: needs-triage
plucky_ngtcp2: needs-triage
devel_ngtcp2: needs-triage
