Candidate: CVE-2023-35169
PublicDate: 2023-06-23 21:15:00 UTC
References:
 https://github.com/Webklex/php-imap/security/advisories/GHSA-47p7-xfcc-4pv9
 https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L252
 https://github.com/Webklex/php-imap/blob/5.2.0/src/Attachment.php#L251-L255
 https://github.com/Webklex/php-imap/pull/414
 https://github.com/Webklex/php-imap/releases/tag/5.3.0
 https://www.cve.org/CVERecord?id=CVE-2023-35169
Description:
 PHP-IMAP is a wrapper for common IMAP communication without the need to
 have the php-imap module installed / enabled. Prior to version 5.3.0, an
 unsanitized attachment filename allows any unauthenticated user to leverage
 a directory traversal vulnerability, which results in a remote code
 execution vulnerability. Every application that stores attachments with
 `Attachment::save()` without providing a `$filename` or passing unsanitized
 user input is affected by this attack. An attacker can send an email with a
 malicious attachment to the inbox, which gets crawled with
 `webklex/php-imap` or `webklex/laravel-imap`. Prerequisite for the
 vulnerability is that the script stores the attachments without providing a
 `$filename`, or providing an unsanitized `$filename`, in
 `src/Attachment::save(string $path, string $filename = null)`. In this
 case, where no `$filename` gets passed into the `Attachment::save()`
 method, the package would use a series of unsanitized and insecure input
 values from the mail as fallback. Even if a developer passes a `$filename`
 into the `Attachment::save()` method, e.g. by passing the name or filename
 of the mail attachment itself (from email headers), the input values never
 get sanitized by the package. There is also no restriction about the file
 extension (e.g. ".php") or the contents of a file. This allows an attacker
 to upload malicious code of any type and content at any location where the
 underlying user has write permissions. The attacker can also overwrite
 existing files and inject malicious code into files that, e.g. get executed
 by the system via cron or requests. Version 5.3.0 contains a patch for this
 issue.
Ubuntu-Description:
Notes:
Mitigation:
Bugs:
Priority: medium
Discovered-by:
Assigned-to:
CVSS:
 github: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H [9.0 CRITICAL]
 nvd: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H [9.8 CRITICAL]

Patches_php-imap:
upstream_php-imap: needs-triage
trusty_php-imap: ignored (end of standard support)
trusty/esm_php-imap: ignored (end of ESM support, was needs-triage)
esm-infra-legacy/trusty_php-imap: needs-triage
xenial_php-imap: ignored (end of standard support)
bionic_php-imap: ignored (end of standard support)
focal_php-imap: DNE
esm-infra/focal_php-imap: DNE
jammy_php-imap: DNE
kinetic_php-imap: DNE
lunar_php-imap: DNE
mantic_php-imap: DNE
noble_php-imap: DNE
oracular_php-imap: DNE
plucky_php-imap: needs-triage
devel_php-imap: needs-triage
