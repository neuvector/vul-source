Candidate: CVE-2020-1938
PublicDate: 2020-02-24 22:15:00 UTC
References:
 https://www.tenable.com/blog/cve-2020-1938-ghostcat-apache-tomcat-ajp-file-readinclusion-vulnerability-cnvd-2020-10487
 https://lists.apache.org/thread.html/r75113652e46c4dee687236510649acfb70d2c63e074152049c3f399d@%3Cnotifications.ofbiz.apache.org%3E
 https://lists.apache.org/thread.html/r7c6f492fbd39af34a68681dbbba0468490ff1a97a1bd79c6a53610ef%40%3Cannounce.tomcat.apache.org%3E
 https://lists.apache.org/thread.html/r856cdd87eda7af40b50278d6de80ee4b42d63adeb433a34a7bdaf9db@%3Cnotifications.ofbiz.apache.org%3E
 https://security.netapp.com/advisory/ntap-20200226-0002/
 https://www.cve.org/CVERecord?id=CVE-2020-1938
 https://www.cisa.gov/known-exploited-vulnerabilities-catalog
Description:
 When using the Apache JServ Protocol (AJP), care must be taken when
 trusting incoming connections to Apache Tomcat. Tomcat treats AJP
 connections as having higher trust than, for example, a similar HTTP
 connection. If such connections are available to an attacker, they can be
 exploited in ways that may be surprising. In Apache Tomcat 9.0.0.M1 to
 9.0.0.30, 8.5.0 to 8.5.50 and 7.0.0 to 7.0.99, Tomcat shipped with an AJP
 Connector enabled by default that listened on all configured IP addresses.
 It was expected (and recommended in the security guide) that this Connector
 would be disabled if not required. This vulnerability report identified a
 mechanism that allowed: - returning arbitrary files from anywhere in the
 web application - processing any file in the web application as a JSP
 Further, if the web application allowed file upload and stored those files
 within the web application (or the attacker was able to control the content
 of the web application by some other means) then this, along with the
 ability to process a file as a JSP, made remote code execution possible. It
 is important to note that mitigation is only required if an AJP port is
 accessible to untrusted users. Users wishing to take a defence-in-depth
 approach and block the vector that permits returning arbitrary files and
 execution as JSP may upgrade to Apache Tomcat 9.0.31, 8.5.51 or 7.0.100 or
 later. A number of changes were made to the default AJP Connector
 configuration in 9.0.31 to harden the default configuration. It is likely
 that users upgrading to 9.0.31, 8.5.51 or 7.0.100 or later will need to
 make small changes to their configurations.
Ubuntu-Description:
Notes:
 mdeslaur> In Ubuntu packages, the AJP connector is disabled by default,
 mdeslaur> so unless specifically enabled by an admin, deployments made
 mdeslaur> using the package are not vulnerable to this issue.
 mdeslaur>
 mdeslaur> One of the upstream fixes for this issue renames the
 mdeslaur> requiredSecret parameter to secret and adds a secretRequired
 mdeslaur> parameter that defaults to "true". Adding this change to stable
 mdeslaur> releases will result in servers failing to start until the
 mdeslaur> administrator either changes secretRequired to "false", or
 mdeslaur> configures an adequate secret. Apache starting supporting a
 mdeslaur> secret in mod_proxy_ajp starting with 2.4.42, which means to
 mdeslaur> enable a secret we will have to issue Apache updates with
 mdeslaur> the backported secret support.
Mitigation:
 mdeslaur> In environments where the AJP connector is enabled, care should
 mdeslaur> be taken to not expose the AJP port to attackers, either by
 mdeslaur> using a firewall to block the AJP port, or by binding it to
 mdeslaur> localhost by using address="127.0.0.1" in the AJP configuration.
Bugs:
 http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=952437
 http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=952438
 http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=952436
 https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=959747 (apache support)
 https://bugs.launchpad.net/bugs/1865904
Priority: low
Discovered-by:
Assigned-to:
Tags: cisa-kev
CVSS:
 nvd: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H [9.8 CRITICAL]
 cisa-adp: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H [9.8 CRITICAL]


Patches_tomcat9:
 upstream: https://github.com/apache/tomcat/commit/0e8a50f0a5958744bea1fd6768c862e04d3b7e75 (9.0.31)
 upstream: https://github.com/apache/tomcat/commit/9ac90532e9a7d239f90952edb229b07c80a9a3eb (9.0.31)
 upstream: https://github.com/apache/tomcat/commit/64fa5b99442589ef0bf2a7fcd71ad2bc68b35fad (9.0.31)
 upstream: https://github.com/apache/tomcat/commit/7a1406a3cd20fdd90656add6cd8f27ef8f24e957 (9.0.31)
 upstream: https://github.com/apache/tomcat/commit/49ad3f954f69c6e838c8cd112ad79aa5fa8e7153 (9.0.31)
upstream_tomcat9: released (9.0.31-1)
precise/esm_tomcat9: DNE
trusty_tomcat9: ignored (end of standard support)
trusty/esm_tomcat9: DNE
esm-infra-legacy/trusty_tomcat9: DNE
xenial_tomcat9: DNE
bionic_tomcat9: ignored (end of standard support, was needed)
esm-apps/bionic_tomcat9: ignored (not vulnerable by default)
eoan_tomcat9: ignored (end of life)
focal_tomcat9: not-affected (9.0.31-1)
esm-apps/focal_tomcat9: not-affected (9.0.31-1)
groovy_tomcat9: not-affected (9.0.31-1)
hirsute_tomcat9: not-affected (9.0.31-1)
impish_tomcat9: not-affected (9.0.31-1)
jammy_tomcat9: not-affected (9.0.31-1)
esm-apps/jammy_tomcat9: not-affected (9.0.31-1)
kinetic_tomcat9: not-affected (9.0.31-1)
lunar_tomcat9: not-affected (9.0.31-1)
mantic_tomcat9: not-affected (9.0.31-1)
noble_tomcat9: not-affected (9.0.31-1)
esm-apps/noble_tomcat9: not-affected (9.0.31-1)
devel_tomcat9: not-affected (9.0.31-1)

Patches_tomcat8:
 upstream: https://github.com/apache/tomcat/commit/69c56080fb3355507e1b55d014ec0ee6767a6150 (8.5.51)
 upstream: https://github.com/apache/tomcat/commit/b962835f98b905286b78c414d5aaec2d0e711f75 (8.5.51)
 upstream: https://github.com/apache/tomcat/commit/9be57601efb8a81e3832feb0dd60b1eb9d2b61d5 (8.5.51)
 upstream: https://github.com/apache/tomcat/commit/64159aa1d7cdc2c118fcb5eac098e70129d54a19 (8.5.51)
 upstream: https://github.com/apache/tomcat/commit/03c436126db6794db5277a3b3d871016fb9a3f23 (8.5.51)
upstream_tomcat8: needs-triage
precise/esm_tomcat8: DNE
trusty_tomcat8: ignored (end of standard support)
trusty/esm_tomcat8: DNE
esm-infra-legacy/trusty_tomcat8: DNE
xenial_tomcat8: ignored (end of standard support, was needed)
esm-infra/xenial_tomcat8: ignored (not vulnerable by default)
bionic_tomcat8: ignored (end of standard support, was needed)
esm-apps/bionic_tomcat8: ignored (not vulnerable by default)
eoan_tomcat8: DNE
focal_tomcat8: DNE
groovy_tomcat8: DNE
hirsute_tomcat8: DNE
impish_tomcat8: DNE
jammy_tomcat8: DNE
kinetic_tomcat8: DNE
lunar_tomcat8: DNE
mantic_tomcat8: DNE
noble_tomcat8: DNE
devel_tomcat8: DNE

Patches_tomcat7:
 upstream: https://github.com/apache/tomcat/commit/0d633e72ebc7b3c242d0081c23bba5e4dacd9b72 (7.0.100)
 upstream: https://github.com/apache/tomcat/commit/40d5d93bd284033cf4a1f77f5492444f83d803e2 (7.0.100)
 upstream: https://github.com/apache/tomcat/commit/b99fba5bd796d876ea536e83299603443842feba (7.0.100)
 upstream: https://github.com/apache/tomcat/commit/f7180bafc74cb1250c9e9287b68a230f0e1f4645 (7.0.100)
upstream_tomcat7: needs-triage
precise/esm_tomcat7: DNE
trusty_tomcat7: ignored (end of standard support)
trusty/esm_tomcat7: ignored
esm-infra-legacy/trusty_tomcat7: ignored
xenial_tomcat7: ignored (end of standard support, was needed)
esm-apps/xenial_tomcat7: ignored (not vulnerable by default)
bionic_tomcat7: ignored (end of standard support, was needed)
esm-apps/bionic_tomcat7: ignored (not vulnerable by default)
eoan_tomcat7: DNE
focal_tomcat7: DNE
groovy_tomcat7: DNE
hirsute_tomcat7: DNE
impish_tomcat7: DNE
jammy_tomcat7: DNE
kinetic_tomcat7: DNE
lunar_tomcat7: DNE
mantic_tomcat7: DNE
noble_tomcat7: DNE
devel_tomcat7: DNE
