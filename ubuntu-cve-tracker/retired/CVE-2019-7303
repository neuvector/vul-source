Candidate: CVE-2019-7303
CRD:
PublicDate: 2019-04-23 16:29:00 UTC
PublicDateAtUSN: 2019-03-21
References:
 https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SnapIoctlTIOCSTI
 https://ubuntu.com/security/notices/USN-3917-1
 https://www.cve.org/CVERecord?id=CVE-2019-7303
Description:
 A vulnerability in the seccomp filters of Canonical snapd before version
 2.37.4 allows a strict mode snap to insert characters into a terminal on a
 64-bit host. The seccomp rules were generated to match 64-bit ioctl(2)
 commands on a 64-bit platform; however, the Linux kernel only uses the
 lower 32 bits to determine which ioctl(2) commands to run. This issue
 affects: Canonical snapd versions prior to 2.37.4.
Ubuntu-Description:
Notes:
 jdstrand> this is a kernel limitation that is documented in the seccomp man
  page, but arguably the kernel should perform the seccomp filter check on the
  value that it is ultimately going to process (which likely means an
  improvement to libseccomp to generate the appropriate BPF to do this)
 jdstrand> this was further complicated by the fact that the kernel and glibc
  disagree on the function prototype of ioctl, where the glibc man page
  documents it as unsigned long and the kernel treats it as int (note, the
  tty_ioctl man page (which is the one that documents TIOCSTI) lists the ioctl
  second argument as an int)
 jdstrand> due to miscoordination, 2.37.4 is going to -updates first as part of
  the regular SRU cycle. Once that passes, we'll rebuild and publish to the
  security pocket and issue a USN.
 jdstrand> once this issue is public, the global profile initialization code
  that is used to address this issue will also be made public
Bugs: 
 https://launchpad.net/bugs/1812973
Priority: medium
Discovered-by: Jann Horn
Assigned-to:
CVSS:
 nvd: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N [7.5 HIGH]
 nvd: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N [7.5 HIGH]

Patches_snapd:
 upstream: https://github.com/snapcore/snapd/pull/6516 (part 1)
 upstream: https://github.com/snapcore/snapd/pull/6533 (part 2)
upstream_snapd: released (2.37.4)
precise/esm_snapd: DNE
trusty_snapd: released (2.37.4~14.04)
trusty/esm_snapd: DNE (trusty was released [2.37.4~14.04])
esm-infra-legacy/trusty_snapd: DNE (trusty/esm was DNE [trusty was released [2.37.4~14.04]])
xenial_snapd: released (2.37.4)
esm-infra/xenial_snapd: not-affected (2.37.4)
bionic_snapd: released (2.37.4+18.04)
esm-infra/bionic_snapd: not-affected (2.37.4+18.04)
cosmic_snapd: released (2.37.4+18.10)
devel_snapd: not-affected (2.37.4+19.04)
