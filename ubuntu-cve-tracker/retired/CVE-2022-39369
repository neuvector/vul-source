PublicDateAtUSN: 2022-11-01 17:15:00 UTC
Candidate: CVE-2022-39369
PublicDate: 2022-11-01 17:15:00 UTC
References:
 https://github.com/apereo/phpCAS/security/advisories/GHSA-8q72-6qq8-xv64
 https://www.cve.org/CVERecord?id=CVE-2022-39369
 https://ubuntu.com/security/notices/USN-6914-1
 https://ubuntu.com/security/notices/USN-6913-1
 https://ubuntu.com/security/notices/USN-6913-2
Description:
 phpCAS is an authentication library that allows PHP applications to easily
 authenticate users via a Central Authentication Service (CAS) server. The
 phpCAS library uses HTTP headers to determine the service URL used to
 validate tickets. This allows an attacker to control the host header and
 use a valid ticket granted for any authorized service in the same SSO realm
 (CAS server) to authenticate to the service protected by phpCAS. Depending
 on the settings of the CAS server service registry in worst case this may
 be any other service URL (if the allowed URLs are configured to
 "^(https)://.*") or may be strictly limited to known and authorized
 services in the same SSO federation if proper URL service validation is
 applied. This vulnerability may allow an attacker to gain access to a
 victim's account on a vulnerable CASified service without victim's
 knowledge, when the victim visits attacker's website while being logged in
 to the same CAS server. phpCAS 1.6.0 is a major version upgrade that starts
 enforcing service URL discovery validation, because there is unfortunately
 no 100% safe default config to use in PHP. Starting this version, it is
 required to pass in an additional service base URL argument when
 constructing the client class. For more information, please refer to the
 upgrading doc. This vulnerability only impacts the CAS client that the
 phpCAS library protects against. The problematic service URL discovery
 behavior in phpCAS < 1.6.0 will only be disabled, and thus you are not
 impacted from it, if the phpCAS configuration has the following setup: 1.
 `phpCAS::setUrl()` is called (a reminder that you have to pass in the full
 URL of the current page, rather than your service base URL), and 2.
 `phpCAS::setCallbackURL()` is called, only when the proxy mode is enabled.
 3. If your PHP's HTTP header input `X-Forwarded-Host`,
 `X-Forwarded-Server`, `Host`, `X-Forwarded-Proto`, `X-Forwarded-Protocol`
 is sanitized before reaching PHP (by a reverse proxy, for example), you
 will not be impacted by this vulnerability either. If your CAS server
 service registry is configured to only allow known and trusted service URLs
 the severity of the vulnerability is reduced substantially in its severity
 since an attacker must be in control of another authorized service.
 Otherwise, you should upgrade the library to get the safe service discovery
 behavior.
Ubuntu-Description:
Notes:
 federicoquattrin> The upstream update is not backward compatible.
 federicoquattrin> Some packages, including fusiondirectory for bionic, will
 federicoquattrin> need manual intervention during the upgrade, leaving users
 federicoquattrin> unable to log in until that happens. Moodle is experiencing
 federicoquattrin> PHP compatibility issues in bionic and is not working in
 federicoquattrin> xenial. OCS Inventory for Xenial is not compatible with
 federicoquattrin> PHP7, the version distributed in Xenial. Therefore we are
 federicoquattrin> not going to fix them.
Mitigation:
Bugs:
 http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1023571
Priority: medium 
Discovered-by: Filip Hejsek
Assigned-to:
CVSS:
 nvd: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H [8.0 HIGH]
 github: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H [8.0 HIGH]

Patches_php-cas:
 usptream: https://github.com/apereo/phpCAS/commit/b759361d904a2cb2a3bcee9411fc348cfde5d163
upstream_php-cas: released (1.6.0-1, 1.6.0)
trusty_php-cas: ignored (end of standard support)
xenial_php-cas: ignored (end of standard support)
esm-apps/xenial_php-cas: released (1.3.3-2ubuntu1+esm1)
bionic_php-cas: ignored (end of standard support, was needed)
esm-apps/bionic_php-cas: ignored (see notes)
focal_php-cas: released (1.3.8-1ubuntu0.20.04.1)
esm-apps/focal_php-cas: released (1.3.8-1ubuntu0.20.04.1)
jammy_php-cas: released (1.3.8-1ubuntu0.22.04.1)
esm-apps/jammy_php-cas: released (1.3.8-1ubuntu0.22.04.1)
kinetic_php-cas: ignored (end of life, was needed)
lunar_php-cas: not-affected (1.6.0-1)
mantic_php-cas: not-affected (1.6.0-1)
noble_php-cas: not-affected (1.6.0-1)
esm-apps/noble_php-cas: not-affected (1.6.0-1)
devel_php-cas: not-affected (1.6.0-1)

Patches_ocsinventory-server:
upstream_ocsinventory-server: released (2.12.2)
xenial_ocsinventory-server: ignored (end of standard support)
esm-apps/xenial_ocsinventory-server: ignored (see notes)
bionic_ocsinventory-server: ignored (end of standard support)
esm-apps/bionic_ocsinventory-server: not-affected (uses system php-cas)
focal_ocsinventory-server: not-affected (uses system php-cas)
esm-apps/focal_ocsinventory-server: not-affected (uses system php-cas)
jammy_ocsinventory-server: released (2.8.1+dfsg1-1ubuntu0.1)
esm-apps/jammy_ocsinventory-server: released (2.8.1+dfsg1-1ubuntu0.1)
noble_ocsinventory-server: not-affected (uses system php-cas)
esm-apps/noble_ocsinventory-server: not-affected (uses system php-cas)
devel_ocsinventory-server: not-affected (uses system php-cas)

Patches_moodle:
 upstream: https://github.com/moodle/moodle/commit/d2bcdfea0e1477179194d5f01f57040f2978214e
upstream_moodle: released (v4.4.1)
xenial_moodle: ignored (end of standard support)
esm-apps/xenial_moodle: ignored (see notes)
bionic_moodle: ignored (end of standard support)
esm-apps/bionic_moodle: ignored (see notes)
focal_moodle: DNE
esm-infra/focal_moodle: DNE
jammy_moodle: DNE
noble_moodle: DNE
devel_moodle: DNE
