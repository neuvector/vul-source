#!/bin/bash
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# remove a package from the devel release.
#
# Author: Tyler Hicks <tyhicks@canonical.com>
# Copyright 2010 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.

# TODO: replace with invocation of mass-cve-edit

for pkg in "$@"; do
    perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;' active/CVE-*
    if [ -d "$(readlink embargoed)" ] ; then
        perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;' embargoed/CVE-*
    fi
    # search through the boilerplates to remove devel entries, but make
    # sure only to touch actual files and not symlinks
    find boilerplates/ -maxdepth 1 -type f -print0 | xargs -0 perl -pi -e 's/^(devel_'"$pkg"':).*/$1 DNE/;'
done

echo "== changed files =="
git status -uno --porcelain

if [ -d "$(readlink embargoed)" ] ; then
    echo
    echo "== changed embargoed files =="
    (cd embargoed && git status -uno --porcelain)
fi
