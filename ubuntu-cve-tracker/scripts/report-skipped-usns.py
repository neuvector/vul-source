#!/usr/bin/env python3
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# reports any unused USNs.
#
# Author: Kees Cook <kees@ubuntu.com>
# Copyright 2008 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.


import optparse
import usn_lib
from source_map import version_compare
from functools import cmp_to_key

parser = optparse.OptionParser()
#parser.add_option("-v", "--verbose", dest="verbose", help="Report logic while processing USNs", action='store_true')
parser.add_option("-s", "--start", help="Specify first USN to check against (default is '-' for autodetection)", action='store', metavar='USN', default="-")
parser.add_option("-D", "--database", help="Specify location of USN data (default 'database-all.pickle')", default="database-all.pickle")
parser.add_option("-d", "--debug", dest="debug", help="Report additional debugging while processing USNs", action='store_true')
(opt, args) = parser.parse_args()

db       = usn_lib.load_database(opt.database)

usns = sorted(db, key=cmp_to_key(version_compare))
seen = set()
for usn in usns:
    num = int(usn.split('-')[0])
    seen.add(num)

if opt.start == "-":
    least = int(usns[0].split('-')[0])
else:
    least = int(opt.start.split('-')[0])

highest = int(usns[-1].split('-')[0])
current = least
while current <= highest:
    if current not in seen:
        print("%d-1" % (current))
    current += 1
