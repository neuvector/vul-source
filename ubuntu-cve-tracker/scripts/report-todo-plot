#!/bin/bash
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# report a terse numeric of CVEs that need attention for supported packages.
#
# Author: Kees Cook <kees@ubuntu.com>
# Copyright 2005 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.


TABLE=$(./scripts/ubuntu-table -s "$@")
for category in ${CATEGORY:-SUPPORTED}
do
  if [ "x$category" = "xuniverse" ]; then
    filter="-v 'SUPPORTED'"
  else
    filter=$category
  fi

  for prio in critical high medium low
  do
    # make sure we don't count each CVE more than once by sorting on unique CVE id
    COUNT=$(echo "$TABLE" | grep $filter | grep ' '"$prio"'$' | cut -d" " -f1 | sort -u | wc -l)
    OUT="$OUT$COUNT "
  done
  if [ -n "$OUT" ]; then
    COUNT=$(echo "$TABLE" | grep $filter | cut -d" " -f2 | cut -d: -f1 | sort -u | wc -l)
    OUT="$OUT$COUNT"
  fi
  echo "$OUT"
done
