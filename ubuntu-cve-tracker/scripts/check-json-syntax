#!/bin/sh
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# serve as wrapper for the json.tool python module to allow for
# batch-checking json files syntax.
#
# Author: Leonidas S. Barbosa <leo.barbosa@canonical.com>
# Copyright 2020 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.


MODIFIED_FILES=$1

for file in $(cat "${MODIFIED_FILES}"); do
	python3 -m json.tool < "${file}" > /dev/null 2>&1
	res=$?
	if [ $res -eq 1 ]; then
		echo "Error in ${file}, run python -m json.tool on it to check"
		exit 1
	fi
done
