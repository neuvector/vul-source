#!/usr/bin/env python3
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# insert specified package metadata into the UCT packages info override file.
#
# Author: Paulo Flabiano Smorigo <pfsmorigo@canonical.com>
# Copyright 2020 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.


import os
import json
import sys

if len(sys.argv) != 4:
    print("Use %s <package> <title> <description>" % sys.argv[0])

package = sys.argv[1]
title = sys.argv[2]
description = sys.argv[3]
json_file = os.environ['UCT'] + "/meta_lists/package_info_overrides.json"

with open(json_file, 'r') as handle:
    parsed = json.load(handle)
    parsed.setdefault(package, {})
    parsed[package]['title'] = title
    parsed[package]['description'] = description
    new_content = json.dumps(parsed, indent=4, sort_keys=True)

with open(json_file, 'w') as handle:
    handle.write(new_content)
