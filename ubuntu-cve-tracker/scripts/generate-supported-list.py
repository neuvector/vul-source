#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# create supported.txt files for ESM. It can also be used for  updating current 
# existing supported.txt files.
#
# Author: Eduardo Barretto <eduardo.barretto@canonical.com>
# Copyright 2024 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.

import argparse
import source_map

def main():
    parser = argparse.ArgumentParser(description='Generate a supported.txt for a given release')
    parser.add_argument('-r', '--release', required=True, action='store',
                        type=str, help='Ubuntu Release coname')
    parser.add_argument('-p', '--product', required=True,
                        choices=['esm-infra', 'esm-apps'],
                        help='Product name, e.g. esm-apps or esm-infra')
    args = parser.parse_args()

    sections = ['main', 'restricted']
    if args.product == 'esm-apps':
        sections = ['universe', 'multiverse']

    srcmap = source_map.load()

    filename = f"{args.product}-{args.release}-supported.txt"
    with open(filename, 'w+') as f:
        for pkg in sorted(srcmap[args.release]):
            if srcmap[args.release][pkg]['section'] in sections:
                f.write(pkg + '\n')

    print(f"{filename} created!")

if __name__ == '__main__':
    main()
