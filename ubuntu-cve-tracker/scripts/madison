#!/usr/bin/env python3
#
# SPDX-License-Identifier: GPL-3.0-only 
#
# This file is part of the Ubuntu CVE Tracker (UCT) scripts, its purpose is to
# act as a really simple madison-like reporting tool that uses source_map data
# for reporting.  Note that it only reports the highest version's entry for
# a given source pkg's release.
#
# Author: Kees Cook <kees@ubuntu.com>
# Author: Jamie Strandboge <jamie@ubuntu.com>
# Copyright 2008 Canonical Ltd.
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License version 3, as published by the
# Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranties of MERCHANTABILITY,
# SATISFACTORY QUALITY, or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http://www.gnu.org/licenses/>.


import cve_lib
import optparse
import source_map

parser = optparse.OptionParser()
parser.add_option("--release", help="Limit to comma-separates list of releases", metavar="NAME", action='store', default=None)
(opt, args) = parser.parse_args()

info = source_map.load()

releases = None
if opt.release:
    releases = opt.release.split(',')

for source in args:
    answer = source_map.madison(info, source, releases)

    for name in sorted(answer.keys()):
        rel, component = name.split('/',1)
        pocket=''
        if '-' in rel:
            rel, pocket = rel.split('-',1)
        for pkg in sorted(answer[name].keys()):
            suffix=""
            if component in ['main','restricted'] and not cve_lib.is_supported(info, pkg, rel):
                suffix = "[unsupported]"
            print('%s | %s | %s%s' % (pkg, answer[name][pkg], name, suffix))
